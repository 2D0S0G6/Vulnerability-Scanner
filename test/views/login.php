<?php include_once 'partials/header.php'; ?>

<main>
    <form method="post" action="login">
        Username: <input type="text" name="username"><br>
        Password: <input type="password" name="password"><br>
        <button type="submit" name="submit" value="Login">Login</button>
    </form>
</main>

<?php
include_once 'partials/footer.php';
session_start();

if (isset($_POST['submit'])) {
    $mysqlController = new MySQLController();

    $username = $_POST['username'];
    $password = $_POST['password'];

    $sql = "SELECT * FROM users WHERE username='$username' AND password='$password'";
    $result = $mysqlController->executeQuery($sql);

    if ($result->num_rows > 0) {
        $_SESSION['username'] = $username;

        $userdata = array('username' => $username, 'role' => 'admin');
        $serializedData = serialize($userdata);
        setcookie('userdata', $serializedData, time() + (86400 * 30), "/");

        header("Location: /");
        exit();
    } else {
        echo "Invalid username or password.";
    }

    $mysqlController->closeConnection();
}
?>

