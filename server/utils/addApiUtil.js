const { v4: uuidv4 } = require('uuid');
const { createTable, insert } = require('../utils/dbUtils');

async function addApi() {
    const columns = {
        id: "INT AUTO_INCREMENT PRIMARY KEY", 
        api_key: "VARCHAR(36) NOT NULL"
    };
    const tableName = "apiKeys";
    
    // Create the table if it doesn't exist
    await createTable(tableName, columns);

    // Generate and insert API keys
    for (let i = 0; i < 10; i++) {
        const uuid = uuidv4();
        const apiKey = { 'api_key': uuid };

        try {
            const insertedId = await insert(tableName, [apiKey]);
            console.log(`API Key ${i + 1}: ${uuid} inserted successfully with ID ${insertedId}.`);
        } catch (error) {
            console.error('Error inserting API key:', error);
        }
    }

    console.log('All API Keys inserted successfully.');
}

module.exports = addApi;
